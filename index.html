<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="node_modules/angular/angular.min.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        var app = angular.module('exercice', []);

        app.controller('FirstCTRL', function ($rootScope, $scope, $timeout) {

            $scope.declaration = "Test 1";

            $timeout(function () {
                $scope.declaration = "Test 2";
                $scope.$apply();
            }, 2000);

//           window.setTimeout(function () {
//                $scope.declaration = "Test 2";
//                $scope.$apply();
//            }, 2000);

//            $scope.displayData = function () {
//                if ($scope.data == 'efreitech') {
//                    $rootScope.data = $scope.data;
//                    $scope.$broadcast('OK');
//                    if ($scope.$broadcast('OK')) {
//                        alert('OK');
//                    }
//                    console.log($scope.$broadcast('OK'));
//                }
//            };

            $scope.$on('alert', function () {
                alert('Alerte');
            });

            $scope.$watch('data', function (newVal, oldVal) {
                $rootScope.data = newVal;
                if (newVal == 'test') {
                    $scope.$broadcast('alert');
                }

//                if ($scope.data == 'test') {
//                    $rootScope.data = $scope.data;
//                    $scope.$broadcast('OK');
//                    if ($scope.$broadcast('OK')) {
//                        alert('OK');
//                    }
//                    console.log($scope.data);
//                }
            });
        });

        app.controller('SecondCTRL', function () {

        });

        app.controller('ThirdCTRL', function () {

        });
    </script>
    <style></style>
</head>
<body ng-app="exercice">
    <div class="container text-center">
        <div class="row" ng-controller="FirstCTRL">
            <!--<form class="col-lg-6 col-lg-offset-3" action="" method="post" ng-submit="displayData()">-->
                <div class="form-group">
                    <input class="form-control" type="text" ng-model="data">
                </div>
                <!--<button type="submit" class="btn btn-info col-lg-12">Envoyer</button>-->
            <!--</form>-->
            <div class="row">
                <p>{{ declaration }}</p>
            </div>
        </div>

        <div class="row" ng-controller="SecondCTRL">
            <p>{{ $root.data }}</p>
        </div>

        <div class="row" ng-controller="ThirdCTRL">
            <p>{{ $root.data }}</p>
        </div>
    </div>
</body>
</html>
